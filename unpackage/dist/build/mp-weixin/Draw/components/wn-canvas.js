(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["Draw/components/wn-canvas"],{"06d1":function(t,e,i){"use strict";i.r(e);var s=i("c137"),a=i("5b9a");for(var r in a)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(r);i("9eb6");var n=i("828b"),o=Object(n["a"])(a["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);e["default"]=o.exports},"1f14":function(t,e,i){},"5b9a":function(t,e,i){"use strict";i.r(e);var s=i("7985"),a=i.n(s);for(var r in s)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(r);e["default"]=a.a},7985:function(t,e,i){"use strict";(function(t){var s=i("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=s(i("7eb4")),r=s(i("ee10")),n={name:"canvas",components:{color:function(){i.e("Draw/components/color").then(function(){return resolve(i("811f"))}.bind(null,i)).catch(i.oe)}},data:function(){return{colorShow:!1,drawContext:null,historyList:[],startX:0,startY:0,lastX:0,lastY:0,mode:"pen",currentColor:"#000",bgColor:"#fff",lineWidth:2,lastRect:{},lastCircle:{},tools:[{title:"清空",key:"clear",url:i("eaaa"),activeUrl:i("eaaa")},{title:"撤回",key:"back",url:i("eca4"),activeUrl:i("eca4")},{title:"橡皮",key:"eraser",url:i("45ba"),activeUrl:i("c14f")},{title:"颜色",key:"color",url:i("df96"),activeUrl:i("d397")},{title:"画笔",key:"pen",url:i("bff5"),activeUrl:i("f987"),active:!0},{title:"直线",key:"line",url:i("50d0"),activeUrl:i("8dcd")},{title:"圆形",key:"circle",url:i("e495"),activeUrl:i("02db")},{title:"方形",key:"rect",url:i("be19"),activeUrl:i("30f8")},{title:"实圆",key:"circle-fill",url:i("b7a1"),activeUrl:i("3505")},{title:"实方",key:"rect-fill",url:i("db5c"),activeUrl:i("c293")},{title:"下载",key:"download",url:i("3af4"),activeUrl:i("3af4")},{title:"分享",key:"share",url:i("73ae"),activeUrl:i("73ae")}],toolsShow:!0,isLandScape:!1,aspectRatio:1}},props:{showSave:{type:Boolean,default:!1},drawImage:{type:String,default:""},saveImageType:{type:String,default:"1"},isUnderBkg:{type:Boolean,default:!1}},mounted:function(e){this.drawContext=t.createCanvasContext("drawCanvas",this),this.initBoard()},methods:{colorShowHandel:function(){this.colorShow=!this.colorShow},chooseTools:function(t){console.log(t),this.colorShow=!1,"back"!=t.key?"clear"!=t.key?("eraser"==t.key&&(this.drawContext.strokeStyle=this.bgColor),"color"==t.key&&this.colorShowHandel(),"download"!=t.key?(this.mode=t.key,this.tools.forEach((function(e,i){e.active=!1,t.key==e.key&&(e.active=!0)}))):this.downloadHandle()):this.clearBoard():this.backHandle()},showTools:function(){this.toolsShow=!this.toolsShow},penWidthChange:function(t){this.lineWidth=t.detail.value,this.drawContext.setLineWidth(this.lineWidth)},penBegin:function(t,e){this.begin=!0,this.drawContext.beginPath(),this.startX=t,this.startY=e,this.drawContext.moveTo(this.startX,this.startY),this.drawPen(t,e)},drawPen:function(t,e){this.drawContext.moveTo(this.startX,this.startY),this.drawContext.lineTo(t,e),this.drawContext.stroke(),this.startX=t,this.startY=e},lineBegin:function(t,e){this.begin=!0,this.startX=t,this.startY=e},lineDraw:function(t,e){this.drawContext.beginPath(),this.drawContext.moveTo(this.startX,this.startY),this.drawContext.lineTo(t,e),this.drawContext.stroke(),this.drawContext.draw(!0)},lineEnd:function(){this.drawContext.closePath(),this.begin=!1},rectFillBegin:function(t,e){this.begin=!0,this.drawContext.beginPath(),this.startX=t,this.startY=e},rectBegin:function(t,e){this.begin=!0,this.drawContext.beginPath(),this.startX=t,this.startY=e},circleFillBegin:function(t,e){this.begin=!0,this.drawContext.beginPath(),this.startX=t,this.startY=e},circleBegin:function(t,e){this.begin=!0,this.drawContext.beginPath(),this.startX=t,this.startY=e},drawRectFill:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=t-this.startX?t-this.startX:this.startX-t,a=e-this.startY?e-this.startY:this.startY-e;this.drawContext.rect(this.startX,this.startY,s,a),this.drawContext.setFillStyle(this.currentColor),this.drawContext.fill(),this.draw(i)},drawRect:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s={},a={},r={},n={};s.X=this.startX<=t?this.startX:t,s.Y=this.startY<=e?this.startY:e,a.X=this.startX>=t?this.startX:t,a.Y=this.startY>=e?this.startY:e,r.X=a.X,r.Y=s.Y,n.X=s.X,n.Y=a.Y;var o=t-this.startX?t-this.startX:this.startX-t,h=e-this.startY?e-this.startY:this.startY-e;this.drawContext.rect(this.startX,this.startY,o,h),this.drawContext.setStrokeStyle(this.currentColor),this.drawContext.stroke(),this.draw(i),this.lastRect={x:this.startX,y:this.startY,width:Math.abs(o),height:Math.abs(h),pointLT:s},this.clearLastRect()},clearLastRect:function(){this.drawContext.clearRect(this.lastRect.pointLT.X+this.lineWidth/2,this.lastRect.pointLT.Y+this.lineWidth/2,this.lastRect.width-this.lineWidth,this.lastRect.height-this.lineWidth)},clearLastCircle:function(t,e,i,s){var a=1;(function t(e,i,r){var n=r-a,o=Math.sqrt(r*r-n*n),h=e-n,l=i-o,c=2*n,d=2*o;a<=r&&(s.clearRect(h,l,c,d),a+=1,t(e,i,r))})(t,e,i)},drawCircleFill:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s={},a={},r={},n={},o={};s.X=this.startX<=t?this.startX:t,s.Y=this.startY<=e?this.startY:e,a.X=this.startX>=t?this.startX:t,a.Y=this.startY>=e?this.startY:e,r.X=a.X,r.Y=s.Y,n.X=s.X,n.Y=a.Y,o.X=(a.X+s.X)/2,o.Y=(a.Y+s.Y)/2;var h=a.X-s.X,l=a.Y-s.Y,c=Math.sqrt(h*h+l*l)/2;this.drawContext.arc(o.X,o.Y,c,0,2*Math.PI),this.drawContext.setFillStyle(this.currentColor),this.drawContext.fill(),this.draw(i)},drawCircle:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s={},a={},r={};s.X=this.startX<=t?this.startX:t,s.Y=this.startY<=e?this.startY:e,a.X=this.startX>=t?this.startX:t,a.Y=this.startY>=e?this.startY:e,r.X=(a.X+s.X)/2,r.Y=(a.Y+s.Y)/2;var n=a.X-s.X,o=a.Y-s.Y,h=Math.sqrt(n*n+o*o)/2;this.drawContext.arc(r.X,r.Y,h,0,2*Math.PI),this.drawContext.stroke(),this.drawContext.beginPath(),this.drawContext.arc(r.X,r.Y,h-this.lineWidth/2,0,2*Math.PI),this.drawContext.setFillStyle(this.bgColor),this.drawContext.fill(),this.draw(i),this.clearLastCircle(r.X,r.Y,h-this.lineWidth/2,this.drawContext)},touchStart:function(t){var e=t.touches[0],i=e.x,s=e.y;switch(console.log("开始touch"),this.mode){case"pen":this.penBegin(i,s);break;case"eraser":this.penBegin(i,s);break;case"line":this.lineBegin(i,s);break;case"rect":this.rectBegin(i,s);break;case"circle":this.circleBegin(i,s);break;case"rect-fill":this.rectFillBegin(i,s);break;case"circle-fill":this.circleFillBegin(i,s);break}this.historyList.push({style:{color:this.currentColor,width:this.lineWidth},coordinates:[{type:t.type,mode:this.mode,x:t.touches[0].x,y:t.touches[0].y}]})},touchMove:function(t){var e=t.touches[0],i=e.x,s=e.y;switch(this.lastX=i,this.lastY=s,console.log("touch移动"),this.mode){case"pen":this.drawPen(i,s),this.draw(!0);break;case"eraser":this.drawPen(i,s),this.draw(!0);break;case"line":return void this.draw(!0);case"rect":this.drawRect(i,s);break;case"circle":this.drawCircle(i,s);break;case"rect-fill":this.drawRectFill(i,s);break;case"circle-fill":this.drawCircleFill(i,s);break}this.historyList[this.historyList.length-1].coordinates.push({type:t.type,mode:this.mode,x:i,y:s})},touchEnd:function(t){var e=t.changedTouches[0],i=e.x,s=e.y;switch(console.log("touch结束"),this.mode){case"pen":this.lineEnd();break;case"eraser":this.drawContext.setFillStyle(this.currentColor),this.lineEnd();break;case"line":this.historyList[this.historyList.length-1].coordinates.push({type:t.type,mode:this.mode,x:i,y:s}),this.lineDraw(i,s),this.lineEnd();break;case"rect":this.drawRect(i,s,!0);break;case"circle":this.drawCircle(i,s);break;case"rect-fill":this.drawRectFill(i,s);break;case"circle-fill":this.drawCircleFill(i,s);break}},backHandle:function(){this.drawContext.draw(),this.historyList.pop(),this.drawHistory()},drawHistory:function(){var t=this;this.historyList.forEach((function(e,i){t.drawContext.beginPath(),t.drawContext.setLineCap("round"),t.drawContext.setStrokeStyle(e.style.color),t.drawContext.setLineWidth(e.style.width),e.coordinates.forEach((function(e){"touchstart"==e.type?t.switchModeToLine(e.mode,1,e.x,e.y):t.switchModeToLine(e.mode,2,e.x,e.y)})),t.drawContext.stroke()})),this.drawContext.draw(!0)},switchModeToLine:function(t,e,i,s){this.drawContext.setFillStyle(this.currentColor),"pen"==t?"1"==e?this.drawContext.moveTo(i,s):this.drawContext.lineTo(i,s):"eraser"==t?(this.drawContext.setFillStyle(this.bgColor),"1"==e?(this.startX=i,this.startY=s):this.lineDraw(i,s,!0)):"line"==t?"1"==e?(this.startX=i,this.startY=s):this.lineDraw(i,s,!0):"rect"==t?"1"==e?(this.startX=i,this.startY=s):this.drawRect(i,s,!0):"circle"==t?"1"==e?(this.startX=i,this.startY=s):this.drawCircle(i,s,!0):"rect-fill"==t?"1"==e?(this.startX=i,this.startY=s):this.drawRectFill(i,s,!0):"circle-fill"==t&&("1"==e?(this.startX=i,this.startY=s):this.drawCircleFill(i,s,!0))},colorPickTapHandler:function(t){var e=this;console.log("我点击的颜色:"+JSON.stringify(t)),this.colorShow=!1,this.tools.forEach((function(t){t.active=!1,"pen"===t.key&&(e.mode="pen",t.active=!0)})),this.currentColor=t.color,this.drawContext.strokeStyle=t.color},downloadHandle:function(){var e=this;1!=this.saveImageType&&3!=this.saveImageType||this.saveImage(),2!=this.saveImageType&&3!=this.saveImageType||t.canvasToTempFilePath({canvasId:"drawCanvas",success:function(i){console.log("回调参数:"+JSON.stringify(i)),t.saveImageToPhotosAlbum({filePath:i.tempFilePath,success:function(t){console.log("成功回调参数:"+JSON.stringify(t)),e.$emit("dowmloadSuc",JSON.stringify(t))},fail:function(t){console.log("失败回调参数:"+JSON.stringify(t)),e.$emit("dowmloadErr",JSON.stringify(t))}})}},this)},saveImage:function(){var e=this;this.isUnderBkg?e.saveImageUrl():t.canvasToTempFilePath({canvasId:"drawCanvas",success:function(t){console.log(t),e.$emit("saveImage",t.tempFilePath)}},this)},saveImageUrl:function(){var e=this,i=t.createSelectorQuery().in(this),s=this;i.select(".canvas-box").boundingClientRect((function(i){e.drawContext.setFillStyle(e.bgColor),e.drawContext.fillRect(0,0,i.width,i.height),e.drawContext.fill(),e.drawContext.drawImage(e.drawImage,0,0,i.width,i.height),e.drawContext.draw(),e.drawHistory(),t.canvasToTempFilePath({canvasId:"drawCanvas",success:function(t){s.$emit("saveImage",t.tempFilePath)}},e)})).exec()},fillBackground:function(){var e=this,i=t.createSelectorQuery().in(this);i.select(".canvas-box").boundingClientRect((function(t){e.drawContext.setFillStyle(e.bgColor),e.drawContext.fillRect(0,0,t.width,t.height),e.drawContext.fill(),e.drawImage&&!e.isUnderBkg&&e.drawContext.drawImage(e.drawImage,0,0,t.width,t.height),e.drawContext.draw()})).exec()},draw:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1?arguments[1]:void 0;this.drawContext.draw(t,(function(){e&&"function"==typeof e&&e()}))},setBoardMode:function(t){var e=this;this.tools.forEach((function(i){i.active=!1,i.key==t&&(i.active=!0,e.mode=t)}))},clearBoard:function(){this.historyList=[],this.drawContext.draw()},initBoard:function(){var e=this;return(0,r.default)(a.default.mark((function i(){var s,r;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s=t.getSystemInfoSync(),s.screenWidth>s.screenHeight?e.isLandScape=!0:e.isLandScape=!1,console.log(e.isLandScape),i.next=5,t.getImageInfo({src:e.drawImage});case 5:if(i.t0=i.sent[1],i.t0){i.next=8;break}i.t0={};case 8:r=i.t0,console.log(r),e.aspectRatio=r.width/r.height,e.isUnderBkg?e.bgColor="rgba(0,0,0,0)":e.bgColor="rgb(255,255,255)",e.drawContext.setLineCap("round"),e.drawContext.strokeStyle=e.currentColor,e.drawContext.setLineWidth(e.lineWidth),e.$nextTick((function(){e.fillBackground()}));case 16:case"end":return i.stop()}}),i)})))()}}};e.default=n}).call(this,i("df3c")["default"])},"9eb6":function(t,e,i){"use strict";var s=i("1f14"),a=i.n(s);a.a},c137:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var s=function(){var t=this.$createElement;this._self._c},a=[]}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'Draw/components/wn-canvas-create-component',
    {
        'Draw/components/wn-canvas-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('df3c')['createComponent'](__webpack_require__("06d1"))
        })
    },
    [['Draw/components/wn-canvas-create-component']]
]);
